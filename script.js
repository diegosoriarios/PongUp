"use strict";var DIFFICULTY=.1,WIDTH=480,HEIGHT=640,PADDLEWIDTH=50,LEFTARROW=37,RIGHTARROW=39,OFFWHITE="#fff",BLUE="#000",time=0,powerUp={},hasPowerUp=!1,powerUpActive=!1;function roundRect(e,t,i,s,d,r,o,p){void 0===p&&(p=!0),void 0===r&&(r=5),e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+s-r,i),e.quadraticCurveTo(t+s,i,t+s,i+r),e.lineTo(t+s,i+d-r),e.quadraticCurveTo(t+s,i+d,t+s-r,i+d),e.lineTo(t+r,i+d),e.quadraticCurveTo(t,i+d,t,i+d-r),e.lineTo(t,i+r),e.quadraticCurveTo(t,i,t+r,i),e.closePath(),p&&e.stroke(),o&&e.fill()}function randomOffset(e,t){return Math.random()*(t-e)+e}function Paddle(e,t){this.width=PADDLEWIDTH,this.height=10,this.x=e,this.y=t,this.x_speed=0,this.y_speed=0}function Computer(){this.score=0;var e=WIDTH/2-PADDLEWIDTH/2;this.paddle=new Paddle(e,10),this.speed=5}function Player(){this.score=0;var e=WIDTH/2-PADDLEWIDTH/2,t=HEIGHT-20;this.paddle=new Paddle(e,t),this.speed=4}function Ball(e,t,i,s,d){this.radius=d||5,this.default_x_position=function(){return void 0===e?WIDTH/2:e},this.default_y_position=function(){return void 0===t?HEIGHT/2:t},this.default_x_speed=function(){return void 0===i?0:i},this.default_y_speed=function(){return void 0===s?3:s},this.resetSpeed=function(){this.x_speed=this.default_x_speed(),this.y_speed=this.default_y_speed()},this.resetPosition=function(){this.x=this.default_x_position(),this.y=this.default_y_position()},this.reset=function(){this.resetSpeed(),this.resetPosition(),time=0,powerUp={},hasPowerUp=!1,powerUpActive=!1},this.reset()}function Pong(e,t,i){var s=i.getElementById(e),d=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},r=i.createElement("canvas");r.width=WIDTH,r.height=HEIGHT,r.style.borderRadius="5px",r.style.border="2px solid "+BLUE;var o=r.getContext("2d");o.fillStyle=BLUE,o.font="12px sans-serif";var p=new Player,a=new Computer,h=new Ball,n={};s.appendChild(r),d(function e(){!function(){if(p.update(n),a.update(h),h.update(p,a),time+=1/60,Math.floor(time)%8==0&&0!==Math.floor(time)&&(hasPowerUp?(powerUp={},hasPowerUp=!1,time=0):powerUp=generatePowerUp()),Math.floor(time)%5==0&&0!==Math.floor(time)&&powerUpActive&&(powerUpActive=!1,p.speed=4,a.speed=4,p.paddle.width=50,a.paddle.width=50),void 0!==powerUp&&h.x-h.radius<powerUp.x+powerUp.w&&h.y-h.radius<powerUp.y+powerUp.h&&h.x+h.radius>powerUp.x&&h.y+h.radius>powerUp.y)switch(powerUpActive=!0,time=0,powerUp.type){case 0:p.speed=2;break;case 1:a.speed=2;break;case 2:p.speed=8;break;case 3:a.speed=8;break;case 4:p.paddle.width=100;break;case 5:a.paddle.width=100;break;case 6:p.paddle.width=25;break;case 7:a.paddle.width=25}}(),o.fillStyle=OFFWHITE,o.fillRect(0,0,r.width,r.height),o.fillStyle=BLUE,p.render(o),a.render(o),h.render(o),void 0!==powerUp&&(o.fillStyle=powerUp.color,o.fillRect(powerUp.x,powerUp.y,powerUp.w,powerUp.h),o.fillStyle=powerUp.textColor,o.rect(powerUp.x,powerUp.y,powerUp.w,powerUp.h),o.stroke(),o.fillStyle=powerUp.textColor,o.textAlign="center",o.fillText(powerUp.text,powerUp.x+20,powerUp.y+20)),d(e)});var l=function(e){n[e.keyCode]=!0},u=function(e){delete n[e.keyCode]},c=function(e){t.removeEventListener("keydown",l,!1),t.removeEventListener("keyup",u,!1),t.removeEventListener("DOMNodeRemoved",c,!1)};return t.addEventListener("keydown",l),t.addEventListener("keyup",u),t.addEventListener("DOMNodeRemoved",c),s}function generatePowerUp(){let e,t,i;hasPowerUp=!0,time=0;let s=Math.floor(8*Math.random());switch(s){case 0:e="Sp--",t="black",i="white";break;case 1:e="Sp--",t="white",i="black";break;case 2:e="Sp++",t="black",i="white";break;case 3:e="Sp++",t="white",i="black";break;case 4:e="Pad++",t="black",i="white";break;case 5:e="Pad++",t="white",i="black";break;case 6:e="Pad--",t="black",i="white";break;case 7:e="Pad--",t="white",i="black"}return{x:Math.floor(Math.random()*(WIDTH-64)),y:HEIGHT/2,type:s,w:32,h:32,text:e,color:t,textColor:i}}Paddle.prototype.render=function(e){roundRect(e,this.x,this.y,this.width,this.height,5,!0,null)},Paddle.prototype.move=function(e,t){this.x+=e,this.y+=t,this.x_speed=e,this.y_speed=t,this.x<0?(this.x=0,this.x_speed=0):this.x+this.width>WIDTH&&(this.x=WIDTH-this.width,this.x_speed=0)},Computer.prototype.render=function(e){this.paddle.render(e),e.fillText(this.score.toString(),5,30)},Computer.prototype.update=function(e){var t=e.x,i=-(this.paddle.x+this.paddle.width/2-t);i<0&&i<-4?i=-this.speed:i>0&&i>4&&(i=this.speed),this.paddle.move(i*randomOffset(DIFFICULTY,1),0),this.paddle.x<0?this.paddle.x=0:this.paddle.x+this.paddle.width>WIDTH&&(this.paddle.x=WIDTH-this.paddle.width)},Player.prototype.render=function(e){this.paddle.render(e),e.fillText(this.score.toString(),5,HEIGHT-30)},Player.prototype.update=function(e){var t;for(var i in e)(t=Number(i))===LEFTARROW?this.paddle.move(-this.speed,0):t===RIGHTARROW?this.paddle.move(this.speed,0):this.paddle.move(0,0)},Ball.prototype.render=function(e){e.beginPath(),e.arc(this.x,this.y,this.radius,2*Math.PI,!1),e.fill()},Ball.prototype.update=function(e,t){this.x+=this.x_speed,this.y+=this.y_speed;var i=this.x-this.radius,s=this.y-this.radius,d=this.x+this.radius,r=this.y+this.radius,o=e.paddle,p=t.paddle,a=this.x-this.radius<0,h=this.x+this.radius>WIDTH;a?(this.x=this.radius,this.x_speed=-this.x_speed):h&&(this.x=WIDTH-this.radius,this.x_speed=-this.x_speed);var n=this.y<0,l=this.y>640;if((n||l)&&(n&&e.score++,l&&t.score++,this.reset()),s>.75*HEIGHT){var u=s<o.y+o.height,c=r>o.y,w=u&&c,f=i<o.x+o.width&&d>o.x;w&&f&&(this.y_speed=randomOffset(-Math.abs(o.x_speed||4),-.9*Math.abs(o.x_speed||4)),this.x_speed+=o.x_speed/2,this.y+=this.y_speed)}else{var x=s<p.y+p.height,y=r>p.y,v=i<p.x+p.width&&d>p.x;x&&y&&v&&(this.y_speed=randomOffset(.9*Math.abs(p.x_speed||4),Math.abs(p.x_speed||4)),this.x_speed+=p.x_speed/2,this.y+=this.y_speed)}};